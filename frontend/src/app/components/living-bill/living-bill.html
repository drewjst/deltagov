<div class="h-full flex flex-col">
  <!-- Loading State -->
  @if (store.isLoadingBill()) {
    <div class="flex-1 flex items-center justify-center">
      <div class="flex flex-col items-center gap-4">
        <lucide-icon [img]="LoaderIcon" class="h-8 w-8 text-primary animate-spin" />
        <span hlmMuted>Loading H.R. 1 - One Big Beautiful Bill...</span>
      </div>
    </div>
  } @else if (store.error()) {
    <div class="flex-1 flex items-center justify-center">
      <div class="flex flex-col items-center gap-4 text-red-400">
        <span>Error: {{ store.error() }}</span>
        <button class="px-4 py-2 bg-primary text-primary-foreground rounded" (click)="store.loadHR1()">
          Retry
        </button>
      </div>
    </div>
  } @else {
  <!-- Bill Header -->
  <div class="p-4 border-b border-border">
    <div class="flex items-center gap-3 mb-2">
      <lucide-icon [img]="FileTextIcon" class="h-5 w-5 text-primary" />
      @if (store.bill(); as bill) {
        <h3 hlmH3>H.R. {{ bill.billNumber }} - {{ bill.title }}</h3>
      } @else {
        <h3 hlmH3>Loading...</h3>
      }
    </div>
    <div class="flex items-center gap-4">
      <div class="flex items-center gap-1">
        <lucide-icon [img]="UserIcon" class="h-4 w-4 text-muted-foreground" />
        <span hlmMuted>{{ store.bill()?.sponsor || 'Loading...' }}</span>
      </div>
      <div class="flex items-center gap-1">
        <lucide-icon [img]="CalendarIcon" class="h-4 w-4 text-muted-foreground" />
        <span hlmMuted>Updated {{ store.bill()?.updateDate || 'Loading...' }}</span>
      </div>
    </div>
  </div>

  <!-- Version Selector -->
  <div class="p-4 border-b border-border bg-secondary/50">
    <div class="flex items-center gap-4">
      <div class="flex items-center gap-2">
        <lucide-icon [img]="GitCompareIcon" class="h-4 w-4 text-muted-foreground" />
        <span hlmMuted>Comparing:</span>
      </div>

      <!-- From Version Select -->
      <brn-select
        [ngModel]="store.selectedFromVersion()"
        (ngModelChange)="onFromVersionChange($event)"
        placeholder="Select version"
      >
        <hlm-select-trigger class="w-44">
          <hlm-select-value />
        </hlm-select-trigger>
        <hlm-select-content>
          @for (version of store.fromVersionOptions(); track version.id) {
            <hlm-option [value]="version.id">{{ version.label }}</hlm-option>
          }
        </hlm-select-content>
      </brn-select>

      <span class="text-muted-foreground">â†’</span>

      <!-- To Version Select -->
      <brn-select
        [ngModel]="store.selectedToVersion()"
        (ngModelChange)="onToVersionChange($event)"
        placeholder="Select version"
      >
        <hlm-select-trigger class="w-44">
          <hlm-select-value />
        </hlm-select-trigger>
        <hlm-select-content>
          @for (version of store.toVersionOptions(); track version.id) {
            <hlm-option [value]="version.id">{{ version.label }}</hlm-option>
          }
        </hlm-select-content>
      </brn-select>
    </div>
  </div>

  <!-- Diff Content with Virtual Scrolling -->
  <cdk-virtual-scroll-viewport
    itemSize="30"
    class="flex-1 font-mono text-sm p-4"
  >
    <div *cdkVirtualFor="let line of store.diffLines(); trackBy: trackByLine" class="mb-0.5">
      @switch (line.type) {
        @case ('deletion') {
          <div class="px-3 py-1 rounded bg-red-500/20 text-red-400 line-through truncate">
            <span class="select-none mr-4 text-red-400/50">{{ line.lineNumber }}</span>
            - {{ line.text }}
          </div>
        }
        @case ('insertion') {
          <div class="px-3 py-1 rounded bg-green-500/20 text-green-400 truncate">
            <span class="select-none mr-4 text-green-400/50">{{ line.lineNumber }}</span>
            + {{ line.text }}
          </div>
        }
        @default {
          <div class="px-3 py-1 rounded bg-muted/30 text-muted-foreground truncate">
            <span class="select-none mr-4 text-muted-foreground/50">{{ line.lineNumber }}</span>
            {{ line.text }}
          </div>
        }
      }
    </div>
  </cdk-virtual-scroll-viewport>

  <!-- Diff Stats Footer -->
  <div class="p-3 border-t border-border bg-secondary/50 flex items-center gap-4">
    @if (store.isLoadingDiff()) {
      <lucide-icon [img]="LoaderIcon" class="h-4 w-4 text-primary animate-spin" />
      <span hlmMuted>Computing diff...</span>
    } @else {
      <span hlmSmall class="text-green-400">+{{ store.diffStats().additions }} additions</span>
      <span hlmSmall class="text-red-400">-{{ store.diffStats().deletions }} deletions</span>
      <span hlmMuted>{{ store.diffStats().total }} lines total</span>
    }
  </div>
  } <!-- End of @else for main content -->
</div>
